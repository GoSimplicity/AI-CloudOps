# æ™ºèƒ½åŠ©æ‰‹ (RAG) ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

AI-CloudOps æ™ºèƒ½åŠ©æ‰‹æ˜¯ä¸€ä¸ªåŸºäºæ£€ç´¢å¢å¼ºç”Ÿæˆ (RAG) æŠ€æœ¯çš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼Œèƒ½å¤Ÿç†è§£è‡ªç„¶è¯­è¨€é—®é¢˜å¹¶ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œæä¾›å‡†ç¡®ã€æœ‰ç”¨çš„å›ç­”ã€‚

## ğŸ§  æ ¸å¿ƒæŠ€æœ¯

### 1. æ£€ç´¢å¢å¼ºç”Ÿæˆ (RAG)
- **æ–‡æ¡£ç´¢å¼•**: å°†çŸ¥è¯†åº“æ–‡æ¡£è½¬æ¢ä¸ºå‘é‡è¡¨ç¤º
- **è¯­ä¹‰æ£€ç´¢**: åŸºäºé—®é¢˜è¯­ä¹‰æ£€ç´¢æœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µ
- **ä¸Šä¸‹æ–‡ç”Ÿæˆ**: ç»“åˆæ£€ç´¢åˆ°çš„å†…å®¹ç”Ÿæˆå‡†ç¡®å›ç­”
- **äº‹å®éªŒè¯**: å‡å°‘å¹»è§‰ï¼Œæé«˜å›ç­”å‡†ç¡®æ€§

### 2. å‘é‡æ•°æ®åº“
- **å‘é‡åŒ–**: ä½¿ç”¨ OpenAI æˆ– Ollama çš„åµŒå…¥æ¨¡å‹
- **å­˜å‚¨**: åŸºäº ChromaDB çš„å‘é‡æ•°æ®åº“
- **æ£€ç´¢**: ä½™å¼¦ç›¸ä¼¼åº¦æœç´¢
- **æ›´æ–°**: æ”¯æŒå¢é‡æ›´æ–°å’Œå…¨é‡é‡å»º

### 3. å¤§è¯­è¨€æ¨¡å‹é›†æˆ
- **OpenAI å…¼å®¹**: æ”¯æŒ GPT-4ã€GPT-3.5 ç­‰æ¨¡å‹
- **Ollama æœ¬åœ°**: æ”¯æŒ Qwenã€Llama ç­‰å¼€æºæ¨¡å‹
- **è‡ªåŠ¨åˆ‡æ¢**: ä¸»å¤‡æ¨¡å¼ï¼Œè‡ªåŠ¨æ•…éšœåˆ‡æ¢
- **æµå¼è¾“å‡º**: æ”¯æŒå®æ—¶å“åº”æµ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºä¼šè¯

```bash
# åˆ›å»ºæ–°çš„å¯¹è¯ä¼šè¯
curl -X POST http://localhost:8080/api/v1/assistant/session

# å“åº”ç¤ºä¾‹
{
  "session_id": "session_20240101_120000",
  "created_at": "2024-01-01T12:00:00Z",
  "status": "active"
}
```

### 2. æé—®æŸ¥è¯¢

```bash
# å‘é€é—®é¢˜æŸ¥è¯¢
curl -X POST http://localhost:8080/api/v1/assistant/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "å¦‚ä½•ä¼˜åŒ–Kubernetesé›†ç¾¤çš„èµ„æºä½¿ç”¨ï¼Ÿ",
    "session_id": "session_20240101_120000",
    "use_web_search": true,
    "max_context_docs": 4
  }'
```

### 3. æµå¼æŸ¥è¯¢

```bash
# WebSocket è¿æ¥è¿›è¡Œæµå¼å¯¹è¯
ws://localhost:8080/api/v1/assistant/stream?session_id=session_20240101_120000
```

## ğŸ“– çŸ¥è¯†åº“ç®¡ç†

### 1. æ”¯æŒçš„æ–‡æ¡£æ ¼å¼

- **Markdown**: .md æ–‡ä»¶
- **PDF**: .pdf æ–‡ä»¶
- **çº¯æ–‡æœ¬**: .txt æ–‡ä»¶
- **CSV**: .csv æ–‡ä»¶
- **JSON**: .json æ–‡ä»¶
- **HTML**: .html æ–‡ä»¶

### 2. æ·»åŠ çŸ¥è¯†

```bash
# 1. å°†æ–‡æ¡£æ·»åŠ åˆ°çŸ¥è¯†åº“ç›®å½•
cp your_document.md data/knowledge_base/

# 2. åˆ·æ–°çŸ¥è¯†åº“
curl -X POST http://localhost:8080/api/v1/assistant/refresh

# 3. éªŒè¯æ·»åŠ ç»“æœ
curl -X GET http://localhost:8080/api/v1/assistant/health
```

### 3. æ–‡æ¡£ç»“æ„å»ºè®®

```markdown
# ä¸»æ ‡é¢˜
## äºŒçº§æ ‡é¢˜
### ä¸‰çº§æ ‡é¢˜

- è¦ç‚¹1
- è¦ç‚¹2
- è¦ç‚¹3

### ä»£ç ç¤ºä¾‹
```bash
kubectl get pods
```

### è¡¨æ ¼ä¿¡æ¯
| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| timeout | è¶…æ—¶æ—¶é—´ | 30s |
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. ç½‘ç»œæœç´¢å¢å¼º

å¼€å¯ç½‘ç»œæœç´¢è·å–æœ€æ–°ä¿¡æ¯ï¼š

```bash
curl -X POST http://localhost:8080/api/v1/assistant/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "Kubernetes 1.29 æœ‰ä»€ä¹ˆæ–°ç‰¹æ€§ï¼Ÿ",
    "session_id": "session_id",
    "use_web_search": true,
    "web_search_num_results": 5
  }'
```

### 2. ä¸Šä¸‹æ–‡æ§åˆ¶

æ§åˆ¶æ£€ç´¢çš„æ–‡æ¡£æ•°é‡å’Œç›¸å…³æ€§ï¼š

```bash
{
  "question": "å¦‚ä½•ç›‘æ§ Pod æ€§èƒ½ï¼Ÿ",
  "session_id": "session_id",
  "max_context_docs": 6,
  "min_relevance_score": 0.7,
  "enable_context_compression": true
}
```

### 3. ä¼šè¯è®°å¿†

ç³»ç»Ÿè‡ªåŠ¨ç»´æŠ¤ä¼šè¯ä¸Šä¸‹æ–‡ï¼š

```bash
# ç¬¬ä¸€ä¸ªé—®é¢˜
POST /api/v1/assistant/query
{
  "question": "ä»€ä¹ˆæ˜¯ Kubernetesï¼Ÿ",
  "session_id": "session_id"
}

# åç»­é—®é¢˜ä¼šåŸºäºä¸Šä¸‹æ–‡
POST /api/v1/assistant/query
{
  "question": "å®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ",  # ç³»ç»Ÿç†è§£"å®ƒ"æŒ‡çš„æ˜¯ Kubernetes
  "session_id": "session_id"
}
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. è¿ç»´çŸ¥è¯†æŸ¥è¯¢

```bash
# æŸ¥è¯¢è¿ç»´æœ€ä½³å®è·µ
{
  "question": "Kubernetes ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹ï¼Ÿ",
  "use_web_search": false,
  "max_context_docs": 5
}
```

### 2. æ•…éšœæ’é™¤æŒ‡å¯¼

```bash
# è·å–æ•…éšœæ’é™¤æŒ‡å¯¼
{
  "question": "Pod ä¸€ç›´å¤„äº Pending çŠ¶æ€ï¼Œå¦‚ä½•æ’æŸ¥ï¼Ÿ",
  "session_id": "troubleshooting_session",
  "max_context_docs": 4
}
```

### 3. é…ç½®å‚è€ƒ

```bash
# è·å–é…ç½®ç¤ºä¾‹
{
  "question": "ç»™æˆ‘ä¸€ä¸ª Nginx Deployment çš„ YAML é…ç½®ç¤ºä¾‹",
  "session_id": "config_session"
}
```

### 4. æœ€ä½³å®è·µå’¨è¯¢

```bash
# è¯¢é—®æœ€ä½³å®è·µ
{
  "question": "å¦‚ä½•è®¾è®¡ Kubernetes é›†ç¾¤çš„ç›‘æ§ä½“ç³»ï¼Ÿ",
  "use_web_search": true,
  "max_context_docs": 6
}
```

## ğŸ›¡ï¸ å®‰å…¨å’Œéšç§

### 1. æ•°æ®éšç§

- **æœ¬åœ°å¤„ç†**: æ•æ„Ÿæ•°æ®ä¸å‘é€åˆ°å¤–éƒ¨æœåŠ¡
- **ä¼šè¯éš”ç¦»**: ä¸åŒä¼šè¯ä¹‹é—´æ•°æ®éš”ç¦»
- **å®šæœŸæ¸…ç†**: è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè¯æ•°æ®

### 2. è®¿é—®æ§åˆ¶

```yaml
# é…ç½®è®¿é—®æ§åˆ¶
assistant:
  security:
    enable_auth: true
    max_sessions_per_user: 5
    session_timeout: 3600
    rate_limit: 100
```

### 3. å†…å®¹è¿‡æ»¤

- **æ•æ„Ÿä¿¡æ¯è¿‡æ»¤**: è‡ªåŠ¨è¿‡æ»¤ API å¯†é’¥ã€å¯†ç ç­‰
- **æ¶æ„å†…å®¹æ£€æµ‹**: æ£€æµ‹å’Œé˜»æ­¢æ¶æ„æé—®
- **è¾“å‡ºå®¡æŸ¥**: å›ç­”å†…å®¹å®‰å…¨å®¡æŸ¥

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å‘é‡æ•°æ®åº“ä¼˜åŒ–

```yaml
# ChromaDB é…ç½®ä¼˜åŒ–
vector_db:
  collection_name: "aiops_knowledge"
  embedding_function: "openai"
  similarity_search:
    k: 10
    score_threshold: 0.6
  index_params:
    ef_construction: 200
    m: 16
```

### 2. ç¼“å­˜ç­–ç•¥

- **æŸ¥è¯¢ç¼“å­˜**: ç¼“å­˜å¸¸è§é—®é¢˜çš„ç­”æ¡ˆ
- **æ–‡æ¡£ç¼“å­˜**: ç¼“å­˜å¤„ç†è¿‡çš„æ–‡æ¡£
- **å‘é‡ç¼“å­˜**: ç¼“å­˜è®¡ç®—è¿‡çš„å‘é‡

### 3. å¹¶å‘æ§åˆ¶

```yaml
assistant:
  performance:
    max_concurrent_queries: 10
    query_timeout: 30
    embedding_batch_size: 100
    max_context_length: 4000
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### 1. å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥åŠ©æ‰‹å¥åº·çŠ¶æ€
curl -X GET http://localhost:8080/api/v1/assistant/health

# å“åº”ç¤ºä¾‹
{
  "status": "healthy",
  "vector_store": "connected",
  "llm_service": "available",
  "knowledge_base": {
    "documents": 25,
    "last_updated": "2024-01-01T12:00:00Z"
  }
}
```

### 2. æ€§èƒ½æŒ‡æ ‡

- **æŸ¥è¯¢å»¶è¿Ÿ**: å¹³å‡æŸ¥è¯¢å“åº”æ—¶é—´
- **æ£€ç´¢å‡†ç¡®ç‡**: æ£€ç´¢åˆ°ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹
- **ç”¨æˆ·æ»¡æ„åº¦**: ç”¨æˆ·å¯¹å›ç­”è´¨é‡çš„è¯„åˆ†

### 3. æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹æŸ¥è¯¢æ—¥å¿—
grep "assistant.query" logs/app.log

# æŸ¥çœ‹æ£€ç´¢æ—¥å¿—
grep "vector_store" logs/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" logs/app.log | grep "assistant"
```

## ğŸ¨ å®šåˆ¶åŒ–é…ç½®

### 1. æç¤ºè¯æ¨¡æ¿

```python
# è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯
SYSTEM_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ Kubernetes è¿ç»´ä¸“å®¶ã€‚
è¯·åŸºäºæä¾›çš„æ–‡æ¡£å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚
å¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·æ˜ç¡®è¯´æ˜ã€‚
å›ç­”è¦å‡†ç¡®ã€ç®€æ´ã€å®ç”¨ã€‚
"""
```

### 2. æ£€ç´¢ç­–ç•¥

```yaml
retrieval:
  strategy: "hybrid"  # semantic, keyword, hybrid
  rerank: true
  max_docs: 10
  min_score: 0.7
  diversity_penalty: 0.1
```

### 3. ç”Ÿæˆå‚æ•°

```yaml
generation:
  temperature: 0.1
  max_tokens: 1000
  top_p: 0.9
  frequency_penalty: 0.0
  presence_penalty: 0.0
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é—®é¢˜è®¾è®¡

- **å…·ä½“æ˜ç¡®**: é¿å…æ¨¡ç³Šçš„é—®é¢˜
- **ä¸Šä¸‹æ–‡å®Œæ•´**: æä¾›å¿…è¦çš„èƒŒæ™¯ä¿¡æ¯
- **åˆ†æ­¥éª¤**: å¤æ‚é—®é¢˜å¯ä»¥åˆ†è§£ä¸ºå¤šä¸ªæ­¥éª¤

### 2. çŸ¥è¯†åº“ç»´æŠ¤

- **å®šæœŸæ›´æ–°**: åŠæ—¶æ›´æ–°è¿‡æœŸä¿¡æ¯
- **ç»“æ„åŒ–**: ä½¿ç”¨æ¸…æ™°çš„æ ‡é¢˜å’Œåˆ†ç±»
- **ç¤ºä¾‹ä¸°å¯Œ**: æä¾›å……è¶³çš„ä»£ç ç¤ºä¾‹

### 3. æ€§èƒ½ä¼˜åŒ–

- **æ‰¹é‡æŸ¥è¯¢**: é¿å…é¢‘ç¹çš„å•æ¬¡æŸ¥è¯¢
- **ç¼“å­˜åˆ©ç”¨**: å……åˆ†åˆ©ç”¨æŸ¥è¯¢ç¼“å­˜
- **ä¼šè¯ç®¡ç†**: é€‚æ—¶æ¸…ç†æ— ç”¨ä¼šè¯

## ğŸ”® æœªæ¥è§„åˆ’

### 1. å¤šæ¨¡æ€æ”¯æŒ

- **å›¾åƒç†è§£**: æ”¯æŒå›¾è¡¨å’Œæ¶æ„å›¾åˆ†æ
- **ä»£ç ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶
- **è¯­éŸ³äº¤äº’**: æ”¯æŒè¯­éŸ³é—®ç­”

### 2. æ™ºèƒ½æ¨è

- **ç›¸å…³é—®é¢˜**: æ¨èç›¸å…³çš„åç»­é—®é¢˜
- **æœ€ä½³å®è·µ**: ä¸»åŠ¨æ¨èæœ€ä½³å®è·µ
- **ä¸ªæ€§åŒ–**: åŸºäºç”¨æˆ·å†å²çš„ä¸ªæ€§åŒ–æ¨è

### 3. é›†æˆå¢å¼º

- **Slack é›†æˆ**: æ”¯æŒ Slack Bot
- **API æ‰©å±•**: æä¾›æ›´å¤š API æ¥å£
- **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶

---

*æ™ºèƒ½åŠ©æ‰‹æ˜¯ AI-CloudOps çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼ŒæŒç»­ä¼˜åŒ–ä¸­ã€‚å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ GitHub Issues åé¦ˆã€‚*