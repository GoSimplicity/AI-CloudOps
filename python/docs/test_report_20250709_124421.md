# AIOpså¹³å°æµ‹è¯•æŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2025-07-09 12:44:21
**æ€»è€—æ—¶**: 98.89ç§’
**æµ‹è¯•æ€»æ•°**: 125
**é€šè¿‡**: 122 (97.6%)
**å¤±è´¥**: 3
**è·³è¿‡**: 0

## æµ‹è¯•è¦†ç›–åº¦åˆ†æ

| åŠŸèƒ½æ¨¡å— | æµ‹è¯•ç”¨ä¾‹æ•° | é€šè¿‡æ•° | å¤±è´¥æ•° | è¦†ç›–ç‡ |
| --- | --- | --- | --- | --- |
| å¥åº·æ£€æŸ¥ | 29 | 27 | 2 | 93.1% |
| åŠ©æ‰‹æœåŠ¡ | 0 | 0 | 0 | 0.0% |
| çŸ¥è¯†åº“ | 2 | 1 | 1 | 50.0% |
| é¢„æµ‹æœåŠ¡ | 100 | 100 | 0 | 100.0% |
| æ ¹å› åˆ†æ | 64 | 64 | 0 | 100.0% |
| è‡ªåŠ¨ä¿®å¤ | 49 | 49 | 0 | 100.0% |
| å…¶ä»– | 0 | 0 | 0 | 0.0% |

## æ‰§è¡Œæ—¶é—´ç»Ÿè®¡

| åŠŸèƒ½æ¨¡å— | å¹³å‡æ‰§è¡Œæ—¶é—´ (ç§’) | æœ€é•¿æµ‹è¯•ç”¨ä¾‹ | æœ€çŸ­æµ‹è¯•ç”¨ä¾‹ |
| --- | --- | --- | --- |
| å¥åº·æ£€æŸ¥ | 1.87 | test_autofix_problematic (11.97s) | test_prometheus_health (0.00s) |
| çŸ¥è¯†åº“ | 12.98 | test_document_recall_rate (15.36s) | test_document_loading (10.61s) |
| é¢„æµ‹æœåŠ¡ | 0.33 | test_full_prediction_workflow (3.13s) | test_model_validation (0.00s) |
| æ ¹å› åˆ†æ | 0.89 | test_rca_health (7.04s) | test_correlation_analysis (0.00s) |
| è‡ªåŠ¨ä¿®å¤ | 4.19 | test_autofix_problematic (11.97s) | test_notification (0.00s) |

## æµ‹è¯•æ¨¡å—æ‘˜è¦

| æ¨¡å— | çŠ¶æ€ | è€—æ—¶ (ç§’) | é€šè¿‡ç‡ |
| --- | --- | --- | --- |
| test_health.py | å¤±è´¥ | 23.38 | 50.0% |
| test_knowledge_load.py | å¤±è´¥ | 26.46 | 50.0% |
| test_prediction.py::test_prediction_health | é€šè¿‡ | 0.35 | 100.0% |
| test_prediction.py::test_prediction_get | é€šè¿‡ | 0.36 | 100.0% |
| test_prediction.py::test_prediction_post | é€šè¿‡ | 0.37 | 100.0% |
| test_prediction.py::test_prediction_zero_qps | é€šè¿‡ | 0.34 | 100.0% |
| test_prediction.py::test_prediction_low_qps | é€šè¿‡ | 0.35 | 100.0% |
| test_prediction.py::test_prediction_high_qps | é€šè¿‡ | 0.36 | 100.0% |
| test_prediction.py::test_prediction_invalid_qps | é€šè¿‡ | 0.35 | 100.0% |
| test_prediction.py::test_trend_prediction | é€šè¿‡ | 0.40 | 100.0% |
| test_prediction.py::test_model_validation | é€šè¿‡ | 0.34 | 100.0% |
| test_prediction.py::test_full_prediction_workflow | é€šè¿‡ | 3.48 | 100.0% |
| test_rca.py::test_rca_health | é€šè¿‡ | 7.52 | 100.0% |
| test_rca.py::test_get_available_metrics | é€šè¿‡ | 0.37 | 100.0% |
| test_rca.py::test_anomaly_detection | é€šè¿‡ | 0.35 | 100.0% |
| test_rca.py::test_correlation_analysis | é€šè¿‡ | 0.35 | 100.0% |
| test_rca.py::test_root_cause_analysis | é€šè¿‡ | 0.36 | 100.0% |
| test_rca.py::test_rca_with_specific_workload | é€šè¿‡ | 0.36 | 100.0% |
| test_rca.py::test_rca_performance | é€šè¿‡ | 0.36 | 100.0% |
| test_rca.py::test_rca_historical_analysis | é€šè¿‡ | 0.35 | 100.0% |
| test_autofix.py::test_autofix_health | é€šè¿‡ | 4.18 | 100.0% |
| test_autofix.py::test_diagnose_cluster | é€šè¿‡ | 0.42 | 100.0% |
| test_autofix.py::test_autofix_normal | é€šè¿‡ | 7.71 | 100.0% |
| test_autofix.py::test_autofix_problematic | é€šè¿‡ | 12.38 | 100.0% |
| test_autofix.py::test_autofix_test_problem | é€šè¿‡ | 6.52 | 100.0% |
| test_autofix.py::test_notification | é€šè¿‡ | 0.39 | 100.0% |
| test_autofix.py::test_workflow | é€šè¿‡ | 0.70 | 100.0% |

## è¯¦ç»†æµ‹è¯•ç»“æœ

### test_health.py

| æµ‹è¯• | çŠ¶æ€ | è€—æ—¶ (ç§’) |
| --- | --- | --- |
| test_health_endpoint | âŒ failed | 6.92 |
| test_prometheus_health | âœ… passed | 0.00 |
| test_kubernetes_health | âœ… passed | 0.01 |
| test_llm_health | âŒ failed | 7.45 |

### test_knowledge_load.py

| æµ‹è¯• | çŠ¶æ€ | è€—æ—¶ (ç§’) |
| --- | --- | --- |
| test_document_loading | âœ… passed | 10.61 |
| test_document_recall_rate | âŒ failed | 15.36 |

### test_prediction.py

| æµ‹è¯• | çŠ¶æ€ | è€—æ—¶ (ç§’) |
| --- | --- | --- |
| test_prediction_health | âœ… passed | 0.00 |
| test_prediction_get | âœ… passed | 0.01 |
| test_prediction_post | âœ… passed | 0.03 |
| test_prediction_zero_qps | âœ… passed | 0.00 |
| test_prediction_low_qps | âœ… passed | 0.00 |
| test_prediction_high_qps | âœ… passed | 0.01 |
| test_prediction_invalid_qps | âœ… passed | 0.00 |
| test_trend_prediction | âœ… passed | 0.06 |
| test_model_validation | âœ… passed | 0.00 |
| test_full_prediction_workflow | âœ… passed | 3.13 |

### test_rca.py

| æµ‹è¯• | çŠ¶æ€ | è€—æ—¶ (ç§’) |
| --- | --- | --- |
| test_rca_health | âœ… passed | 7.04 |
| test_get_available_metrics | âœ… passed | 0.02 |
| test_anomaly_detection | âœ… passed | 0.00 |
| test_correlation_analysis | âœ… passed | 0.00 |
| test_root_cause_analysis | âœ… passed | 0.01 |
| test_rca_with_specific_workload | âœ… passed | 0.01 |
| test_rca_performance | âœ… passed | 0.01 |
| test_rca_historical_analysis | âœ… passed | 0.02 |

### test_autofix.py

| æµ‹è¯• | çŠ¶æ€ | è€—æ—¶ (ç§’) |
| --- | --- | --- |
| test_autofix_health | âœ… passed | 3.73 |
| test_diagnose_cluster | âœ… passed | 0.03 |
| test_autofix_normal | âœ… passed | 7.25 |
| test_autofix_problematic | âœ… passed | 11.97 |
| test_autofix_test_problem | âœ… passed | 6.05 |
| test_notification | âœ… passed | 0.00 |
| test_workflow | âœ… passed | 0.28 |

## å¤±è´¥æµ‹è¯•è¯¦æƒ…

### test_health.py: test_health_endpoint

```
client = <FlaskClient <Flask 'app.main'>>

    def test_health_endpoint(client):
        """æµ‹è¯•å¥åº·æ£€æŸ¥APIç«¯ç‚¹"""
        logger.info("æµ‹è¯•å¥åº·æ£€æŸ¥APIç«¯ç‚¹")
    
        response = client.get('/api/v1/health')
    
        assert response.status_code == 200
    
        data = json.loads(response.data)
        assert 'code' in data
        assert data['code'] == 0
        assert 'data' in data
        assert 'status' in data['data']
>       assert data['data']['status'] == 'healthy'
E       AssertionError: assert 'unhealthy' == 'healthy'
E         
E         [0m[91m- healthy[39;49;00m[90m[39;49;00m
E         [92m+ unhealthy[39;49;00m[90m[39;49;00m
E         ? ++[90m[39;49;00m

tests/test_health.py:41: AssertionError
```

### test_health.py: test_llm_health

```
llm_service = <app.services.llm.LLMService object at 0x16bb76990>

    @pytest.mark.skipif(
        os.environ.get("SKIP_LLM_TESTS", "false").lower() == "true",
        reason="LLM APIæµ‹è¯•è¢«ç¯å¢ƒå˜é‡ç¦ç”¨"
    )
    def test_llm_health(llm_service):
        """æµ‹è¯•LLMæœåŠ¡å¥åº·çŠ¶æ€"""
        logger.info("æµ‹è¯•LLMæœåŠ¡å¥åº·çŠ¶æ€")
    
>       assert llm_service.is_healthy() == True
E       assert False == True
E        +  where False = is_healthy()
E        +    where is_healthy = <app.services.llm.LLMService object at 0x16bb76990>.is_healthy

tests/test_health.py:76: AssertionError
```

### test_knowledge_load.py: test_document_recall_rate

```
@pytest.mark.asyncio
    async def test_document_recall_rate():
        """æµ‹è¯•æ–‡æ¡£å¬å›ç‡"""
        logger.info("æµ‹è¯•æ–‡æ¡£å¬å›ç‡")
    
        from app.core.agents.assistant import AssistantAgent
        import time
    
        # åˆ›å»ºåŠ©æ‰‹ä»£ç†å®ä¾‹
        agent = AssistantAgent()
    
        # å®šä¹‰æµ‹è¯•é—®é¢˜å’Œé¢„æœŸå…³é”®è¯
        test_cases = [
            {
                "question": "AIOpså¹³å°æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ",
                "keywords": ["AIOps", "åŠŸèƒ½", "å¹³å°"]
            },
            {
                "question": "å¦‚ä½•è¿›è¡Œæ ¹å› åˆ†æï¼Ÿ",
                "keywords": ["æ ¹å› ", "åˆ†æ"]
            },
            {
                "question": "æ™ºèƒ½å°åŠ©æ‰‹å¦‚ä½•å·¥ä½œï¼Ÿ",
                "keywords": ["æ™ºèƒ½", "å°åŠ©æ‰‹", "å·¥ä½œ"]
            }
        ]
    
        total_cases = len(test_cases)
        successful_recalls = 0
        total_recall_rate = 0.0
        recall_scores = []
    
        for idx, test_case in enumerate(test_cases):
            question = test_case["question"]
            keywords = test_case["keywords"]
    
            logger.info(f"æµ‹è¯•æ¡ˆä¾‹ {idx+1}/{total_cases}: {question}")
    
            # è·å–ç›¸å…³æ–‡æ¡£
            docs = agent._get_relevant_docs(question)
    
            # è®¡ç®—å¬å›ç‡
            doc_text = " ".join([doc.page_content for doc in docs])
            matched_keywords = sum(1 for keyword in keywords if keyword.lower() in doc_text.lower())
            recall_rate = matched_keywords / len(keywords) if keywords else 0
    
            recall_scores.append(recall_rate)
            total_recall_rate += recall_rate
    
            if recall_rate >= 0.5:  # å¦‚æœå¬å›ç‡è¶…è¿‡50%ï¼Œè§†ä¸ºæˆåŠŸ
                successful_recalls += 1
    
            logger.info(f"  - å¬å›ç‡: {recall_rate:.2f} ({matched_keywords}/{len(keywords)}å…³é”®è¯åŒ¹é…)")
    
        # è®¡ç®—å¹³å‡å¬å›ç‡
        avg_recall_rate = total_recall_rate / total_cases
        success_rate = successful_recalls / total_cases
    
        logger.info(f"å¹³å‡æ–‡æ¡£å¬å›ç‡: {avg_recall_rate:.2f}")
        logger.info(f"å¬å›æˆåŠŸç‡: {success_rate:.2f} ({successful_recalls}/{total_cases})")
    
        # éªŒè¯å¹³å‡å¬å›ç‡æ˜¯å¦è¾¾åˆ°é¢„æœŸ
        # å¯¹äºæµ‹è¯•ç¯å¢ƒé™ä½é¢„æœŸå€¼
        if 'pytest' in sys.modules:
>           assert avg_recall_rate >= 0.1, f"å¹³å‡å¬å›ç‡ {avg_recall_rate:.2f} ä½äºé¢„æœŸçš„ 0.1"
E           AssertionError: å¹³å‡å¬å›ç‡ 0.00 ä½äºé¢„æœŸçš„ 0.1
E           assert 0.0 >= 0.1

tests/test_knowledge_load.py:115: AssertionError
```

## æµ‹è¯•è¦†ç›–åº¦çƒ­åŠ›å›¾

```mermaid
heatmap
title é¡¹ç›®æµ‹è¯•è¦†ç›–åº¦
x-axis ["åŠŸèƒ½æ¨¡å—"]
y-axis ["è¦†ç›–æƒ…å†µ"]
"prediction" : 9
"knowledge_load" : 5
"health" : 5
"autofix" : 9
"rca" : 9
```

## æµ‹è¯•æ”¹è¿›å»ºè®®

### æ”¹è¿›å»ºè®®

1. **æé«˜ä»£ç è¦†ç›–ç‡**: è€ƒè™‘æ·»åŠ æ›´å¤šå•å…ƒæµ‹è¯•ä»¥è¦†ç›–æ›´å¤šä»£ç è·¯å¾„
2. **å¢åŠ è¾¹ç•Œæµ‹è¯•**: é’ˆå¯¹å¯èƒ½çš„è¾¹ç•Œæƒ…å†µæ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹
3. **æ”¹è¿›æµ‹è¯•é€Ÿåº¦**: éƒ¨åˆ†æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œå¯ä»¥è€ƒè™‘è¿›è¡Œä¼˜åŒ–
4. **æé«˜æµ‹è¯•è´¨é‡**: æ›¿æ¢è¿”å›å€¼æµ‹è¯•ä¸ºæ–­è¨€æµ‹è¯•ï¼Œéµå¾ªpytestæœ€ä½³å®è·µ
5. **æ·»åŠ é›†æˆæµ‹è¯•**: å¢å¼ºç³»ç»Ÿå„ç»„ä»¶é—´çš„é›†æˆæµ‹è¯•

## æ€»ç»“

æµ‹è¯•è¦†ç›–åº¦: **97.6%**ï¼Œæ•´ä½“çŠ¶æ€: **è‰¯å¥½**
å­˜åœ¨ 3 ä¸ªæµ‹è¯•å¤±è´¥ï¼Œéœ€è¦ä¿®å¤